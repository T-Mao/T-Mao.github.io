<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Building a Real-Time Chat Feature | Tongze Mao </title> <meta name="author" content="Tongze Mao"> <meta name="description" content="An in-depth look at real-time chat implementation for mobile apps"> <meta name="keywords" content="Tongze Mao, Computer Science, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?86fbbecec189054f486c8d20d21d47df" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/notion_tran.ico?77fbfb63394a7e37d18d66a902a5f583"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://t-mao.github.io/blog/2025/Chat/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Tongze</span> Mao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Building a Real-Time Chat Feature</h1> <p class="post-meta"> Created in February 25, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/mobile"> <i class="fa-solid fa-hashtag fa-sm"></i> mobile</a>   <a href="/blog/tag/flutter"> <i class="fa-solid fa-hashtag fa-sm"></i> flutter</a>   <a href="/blog/tag/chat"> <i class="fa-solid fa-hashtag fa-sm"></i> chat</a>   <a href="/blog/tag/messaging"> <i class="fa-solid fa-hashtag fa-sm"></i> messaging</a>   ·   <a href="/blog/category/mobile-dev"> <i class="fa-solid fa-tag fa-sm"></i> mobile-dev</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <div class="row"> <div class="col-sm mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="https://media.istockphoto.com/id/1300739733/vector/message-bubbles-text-balloon-on-phone-dispaly-vector-design-template-for-messenger-chat.jpg?s=612x612&amp;w=0&amp;k=20&amp;c=5XaPB5sDo9f_hNm1Lg3SjIqockS-Pc94XRVWzVVBnco=" sizes="95vw"></source> <img src="https://media.istockphoto.com/id/1300739733/vector/message-bubbles-text-balloon-on-phone-dispaly-vector-design-template-for-messenger-chat.jpg?s=612x612&amp;w=0&amp;k=20&amp;c=5XaPB5sDo9f_hNm1Lg3SjIqockS-Pc94XRVWzVVBnco=" class="rounded z-depth-1" width="100%" height="auto" style=" max-width: 800px; " title="Chat" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Building a robust, real-time chat system is crucial for many mobile apps, from on-demand service platforms to social communities. In this post, I’ll outline the architecture and code considerations involved in creating a Flutter-based chat feature with message synchronization, backend triggers, and advanced user-interface design.</p> <hr> <h2 id="high-level-approach">High-Level Approach</h2> <ol> <li> <strong>Backend Integration</strong>: I rely on REST APIs or serverless functions (Firebase Functions, AWS Lambdas, etc.) for sending/receiving messages, updating read statuses, and broadcasting system events (like a user leaving, or the system acknowledging a payment).</li> <li> <strong>Local State &amp; UI</strong>: On the client side, Flutter apps use <code class="language-plaintext highlighter-rouge">StreamBuilder</code>, <code class="language-plaintext highlighter-rouge">ListView</code>, or custom polling to keep a local record of conversation history. When new messages arrive, they’re appended to the local list, and the view updates in real time.</li> <li> <strong>Permissions &amp; Validation</strong>: Ensure each user only accesses messages relevant to their order or context. Some apps also rely on role-based or ID-based verification to handle certain logic (e.g., “technicians” vs. “customers”).</li> </ol> <hr> <h2 id="basic-architecture">Basic Architecture</h2> <p>The chat data model typically includes:</p> <ul> <li> <strong>Message</strong>: Contains <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">senderId</code>, <code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">imageUrl</code> (if any), <code class="language-plaintext highlighter-rouge">timestamp</code>, <code class="language-plaintext highlighter-rouge">messageType</code> (e.g., normal vs. system).</li> <li> <strong>Conversation</strong> (optional): Tracks participants, unread counts, etc.</li> <li> <strong>Server</strong>: Receives new messages through an HTTP endpoint or direct Firestore writes, then broadcasts them to all relevant participants.</li> </ul> <p>For real-time notification, you can use push notifications or background fetch logic. However, many situations also employ short polling if the user is already in the chat screen—this can sometimes simplify concurrency or offline cases.</p> <hr> <h2 id="flutter-ui-example">Flutter UI Example</h2> <p>Below is a condensed snippet illustrating how I might manage message state, handle text+image inputs, and display messages in conversation bubbles.</p> <div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'package:flutter/material.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'dart:typed_data'</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">ChatMessage</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">senderId</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">text</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">String</span><span class="o">?</span> <span class="n">imageUrl</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">timestamp</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">bool</span> <span class="n">isSystemMessage</span><span class="p">;</span>

  <span class="n">ChatMessage</span><span class="p">({</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="p">,</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">senderId</span><span class="p">,</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="p">,</span>
    <span class="k">this</span><span class="o">.</span><span class="na">imageUrl</span><span class="p">,</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">timestamp</span><span class="p">,</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isSystemMessage</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ChatPage</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">conversationId</span><span class="p">;</span>
  <span class="kd">const</span> <span class="n">ChatPage</span><span class="p">({</span><span class="n">Key</span><span class="o">?</span> <span class="n">key</span><span class="p">,</span> <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">conversationId</span><span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="nl">key:</span> <span class="n">key</span><span class="p">);</span>

  <span class="nd">@override</span>
  <span class="n">State</span><span class="p">&lt;</span><span class="n">ChatPage</span><span class="p">&gt;</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_ChatPageState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_ChatPageState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">ChatPage</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">_messageController</span> <span class="o">=</span> <span class="n">TextEditingController</span><span class="p">();</span>
  <span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatMessage</span><span class="p">&gt;</span> <span class="n">_messages</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kt">bool</span> <span class="n">_isUploading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="n">Uint8List</span><span class="o">?</span> <span class="n">_pendingImageBytes</span><span class="p">;</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">initState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="na">initState</span><span class="p">();</span>
    <span class="n">_fetchMessages</span><span class="p">();</span> <span class="c1">// initial fetch</span>
    <span class="c1">// Optionally set up a periodic polling or streaming subscription</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">_fetchMessages</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="c1">// Call backend or DB to load existing messages</span>
    <span class="kd">final</span> <span class="n">fetchedMessages</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_mockFetchMessagesFromServer</span><span class="p">();</span>
    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
      <span class="n">_messages</span> <span class="o">=</span> <span class="n">fetchedMessages</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="n">Future</span><span class="p">&lt;</span><span class="kt">List</span><span class="p">&lt;</span><span class="n">ChatMessage</span><span class="p">&gt;&gt;</span> <span class="n">_mockFetchMessagesFromServer</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="c1">// Replace with your actual logic, e.g.:</span>
    <span class="k">await</span> <span class="n">Future</span><span class="o">.</span><span class="na">delayed</span><span class="p">(</span><span class="kd">const</span> <span class="n">Duration</span><span class="p">(</span><span class="nl">milliseconds:</span> <span class="mi">500</span><span class="p">));</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="n">ChatMessage</span><span class="p">(</span>
        <span class="nl">id:</span> <span class="s">'m1'</span><span class="p">,</span>
        <span class="nl">senderId:</span> <span class="s">'customer123'</span><span class="p">,</span>
        <span class="nl">text:</span> <span class="s">'Hi, I have a question about my order.'</span><span class="p">,</span>
        <span class="nl">timestamp:</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="p">()</span><span class="o">.</span><span class="na">millisecondsSinceEpoch</span> <span class="o">-</span> <span class="mi">60000</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="n">ChatMessage</span><span class="p">(</span>
        <span class="nl">id:</span> <span class="s">'m2'</span><span class="p">,</span>
        <span class="nl">senderId:</span> <span class="s">'system'</span><span class="p">,</span>
        <span class="nl">text:</span> <span class="s">'System event: The technician is en route.'</span><span class="p">,</span>
        <span class="nl">timestamp:</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="p">()</span><span class="o">.</span><span class="na">millisecondsSinceEpoch</span> <span class="o">-</span> <span class="mi">30000</span><span class="p">,</span>
        <span class="nl">isSystemMessage:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="n">Future</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;</span> <span class="n">_sendMessage</span><span class="p">({</span><span class="kt">String</span><span class="o">?</span> <span class="n">text</span><span class="p">,</span> <span class="kt">String</span><span class="o">?</span> <span class="n">imageUrl</span><span class="p">})</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="c1">// Make sure we have content</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">text</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">text</span><span class="o">.</span><span class="na">isEmpty</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">imageUrl</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">imageUrl</span><span class="o">.</span><span class="na">isEmpty</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Construct a local message</span>
    <span class="kd">final</span> <span class="n">newMsg</span> <span class="o">=</span> <span class="n">ChatMessage</span><span class="p">(</span>
      <span class="nl">id:</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="p">()</span><span class="o">.</span><span class="na">millisecondsSinceEpoch</span><span class="o">.</span><span class="na">toString</span><span class="p">(),</span>
      <span class="nl">senderId:</span> <span class="s">'technician456'</span><span class="p">,</span>
      <span class="nl">text:</span> <span class="n">text</span> <span class="o">??</span> <span class="s">''</span><span class="p">,</span>
      <span class="nl">imageUrl:</span> <span class="n">imageUrl</span><span class="p">,</span>
      <span class="nl">timestamp:</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="p">()</span><span class="o">.</span><span class="na">millisecondsSinceEpoch</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1">// Update local UI</span>
    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
      <span class="n">_messages</span><span class="o">.</span><span class="na">add</span><span class="p">(</span><span class="n">newMsg</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// Optionally call backend to persist</span>
    <span class="c1">// e.g., await MyAPI.sendChatMessage(widget.conversationId, newMsg);</span>
  <span class="p">}</span>

  <span class="n">Widget</span> <span class="n">_buildMessageBubble</span><span class="p">(</span><span class="n">ChatMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="na">isSystemMessage</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// system bubble</span>
      <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
        <span class="nl">margin:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">symmetric</span><span class="p">(</span><span class="nl">vertical:</span> <span class="mi">8</span><span class="p">),</span>
        <span class="nl">alignment:</span> <span class="n">Alignment</span><span class="o">.</span><span class="na">center</span><span class="p">,</span>
        <span class="nl">child:</span> <span class="n">Container</span><span class="p">(</span>
          <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
          <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
            <span class="nl">color:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">grey</span><span class="o">.</span><span class="na">shade200</span><span class="p">,</span>
            <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
          <span class="p">),</span>
          <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">.</span><span class="na">text</span><span class="p">,</span>
            <span class="nl">textAlign:</span> <span class="n">TextAlign</span><span class="o">.</span><span class="na">center</span><span class="p">,</span>
            <span class="nl">style:</span> <span class="kd">const</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">fontStyle:</span> <span class="n">FontStyle</span><span class="o">.</span><span class="na">italic</span><span class="p">),</span>
          <span class="p">),</span>
        <span class="p">),</span>
      <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">final</span> <span class="kt">bool</span> <span class="n">isMine</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="na">senderId</span> <span class="o">==</span> <span class="s">'technician456'</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
      <span class="nl">margin:</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">fromLTRB</span><span class="p">(</span><span class="n">isMine</span> <span class="o">?</span> <span class="mi">60</span> <span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">isMine</span> <span class="o">?</span> <span class="mi">10</span> <span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
      <span class="nl">decoration:</span> <span class="n">BoxDecoration</span><span class="p">(</span>
        <span class="nl">color:</span> <span class="n">isMine</span> <span class="o">?</span> <span class="n">Colors</span><span class="o">.</span><span class="na">blue</span><span class="o">.</span><span class="na">shade100</span> <span class="o">:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">green</span><span class="o">.</span><span class="na">shade100</span><span class="p">,</span>
        <span class="nl">borderRadius:</span> <span class="n">BorderRadius</span><span class="o">.</span><span class="na">circular</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
      <span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Column</span><span class="p">(</span>
        <span class="nl">crossAxisAlignment:</span>
            <span class="n">isMine</span> <span class="o">?</span> <span class="n">CrossAxisAlignment</span><span class="o">.</span><span class="na">end</span> <span class="o">:</span> <span class="n">CrossAxisAlignment</span><span class="o">.</span><span class="na">start</span><span class="p">,</span>
        <span class="nl">children:</span> <span class="p">[</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="p">)</span>
            <span class="n">Text</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="na">text</span><span class="p">),</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="na">imageUrl</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">msg</span><span class="o">.</span><span class="na">imageUrl</span><span class="o">!.</span><span class="na">isNotEmpty</span><span class="p">)</span>
            <span class="n">Padding</span><span class="p">(</span>
              <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">only</span><span class="p">(</span><span class="nl">top:</span> <span class="mi">8</span><span class="p">),</span>
              <span class="nl">child:</span> <span class="n">Image</span><span class="o">.</span><span class="na">network</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="na">imageUrl</span><span class="o">!</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">],</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
      <span class="nl">appBar:</span> <span class="n">AppBar</span><span class="p">(</span>
        <span class="nl">title:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'Conversation #</span><span class="si">${widget.conversationId}</span><span class="s">'</span><span class="p">),</span>
      <span class="p">),</span>
      <span class="nl">body:</span> <span class="n">Column</span><span class="p">(</span>
        <span class="nl">children:</span> <span class="p">[</span>
          <span class="n">Expanded</span><span class="p">(</span>
            <span class="nl">child:</span> <span class="n">ListView</span><span class="o">.</span><span class="na">builder</span><span class="p">(</span>
              <span class="nl">itemCount:</span> <span class="n">_messages</span><span class="o">.</span><span class="na">length</span><span class="p">,</span>
              <span class="nl">itemBuilder:</span> <span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_buildMessageBubble</span><span class="p">(</span><span class="n">_messages</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="p">),</span>
          <span class="p">),</span>
          <span class="n">_buildTextComposer</span><span class="p">(),</span>
        <span class="p">],</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Widget</span> <span class="n">_buildTextComposer</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">SafeArea</span><span class="p">(</span>
      <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
        <span class="nl">children:</span> <span class="p">[</span>
          <span class="n">IconButton</span><span class="p">(</span>
            <span class="nl">icon:</span> <span class="kd">const</span> <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="o">.</span><span class="na">add_photo_alternate</span><span class="p">),</span>
            <span class="nl">onPressed:</span> <span class="n">_onSelectImage</span><span class="p">,</span>
          <span class="p">),</span>
          <span class="n">Expanded</span><span class="p">(</span>
            <span class="nl">child:</span> <span class="n">TextField</span><span class="p">(</span>
              <span class="nl">controller:</span> <span class="n">_messageController</span><span class="p">,</span>
              <span class="nl">decoration:</span> <span class="kd">const</span> <span class="n">InputDecoration</span><span class="p">(</span>
                <span class="nl">hintText:</span> <span class="s">'Type your message...'</span><span class="p">,</span>
              <span class="p">),</span>
            <span class="p">),</span>
          <span class="p">),</span>
          <span class="n">IconButton</span><span class="p">(</span>
            <span class="nl">icon:</span> <span class="kd">const</span> <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="o">.</span><span class="na">send</span><span class="p">),</span>
            <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
              <span class="kd">final</span> <span class="n">text</span> <span class="o">=</span> <span class="n">_messageController</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">trim</span><span class="p">();</span>
              <span class="n">_messageController</span><span class="o">.</span><span class="na">clear</span><span class="p">();</span>
              <span class="n">_sendMessage</span><span class="p">(</span><span class="nl">text:</span> <span class="n">text</span><span class="p">);</span>
            <span class="p">},</span>
          <span class="p">),</span>
        <span class="p">],</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Pseudocode for image picking</span>
  <span class="n">Future</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;</span> <span class="n">_onSelectImage</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="c1">// final selectedFile = await pickImage(); // implement picking</span>
    <span class="c1">// _isUploading = true; setState(() {});</span>
    <span class="c1">// final uploadedUrl = await MyAPI.uploadFile(selectedFile);</span>
    <span class="c1">// _isUploading = false; setState(() {});</span>
    <span class="c1">// _sendMessage(imageUrl: uploadedUrl);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="key-observations">Key Observations</h3> <ul> <li>The code uses a local <code class="language-plaintext highlighter-rouge">_messages</code> list for immediate UI updates.</li> <li>Actual network calls (e.g., to a REST endpoint or Firestore) happen in an async function. This ensures the UI remains responsive.</li> <li>System messages (like “technician is on the way”) are displayed differently than normal user messages.</li> </ul> <hr> <h2 id="handling-advanced-scenarios">Handling Advanced Scenarios</h2> <ul> <li> <strong>Unread Indicators</strong>: If multiple screens or partial user sessions are involved, track <code class="language-plaintext highlighter-rouge">lastSeenMessageTime</code> on the server. In my apps, I typically store each user’s last-read timestamp in a database and then highlight any newer messages.</li> <li> <strong>Delivery Receipts</strong>: If you need full reliability (like “delivered” or “read” confirmations), design a small queue to push read acknowledgements back to the server.</li> <li> <strong>Push Notifications</strong>: Typically used if a user is outside the app. On new messages, a backend function triggers a push, and the mobile OS (Android/iOS) displays it. Tapping the notification deep-links into the chat screen.</li> </ul> <hr> <h2 id="concluding-thoughts">Concluding Thoughts</h2> <p>Building a chat feature requires careful orchestration between the frontend, backend, and push notification system. By focusing on clarity of message structures, implementing robust synchronization (pull or push), and differentiating user/system flows in the UI, you’ll create a messaging experience that feels immediate and stable. Whether you’re working on a simple 1-on-1 chat or a large multi-participant system, these core principles remain the same.</p> <p>If done right, a real-time chat not only boosts user engagement but also enables advanced features—such as in-chat payments, scheduling, and shared media—making your mobile app far more valuable in the eyes of both users.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Planning/">Future Career Planning &amp; Summary - Reflecting on SupTech, What’s My Next Step?</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Google-Maps/">Harnessing Google Maps for Real-Time Mobile Apps</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Stripe-Payments/">Integrating Stripe Payments in Mobile Apps</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Network-Calls/">Streamlining Network Calls with a Custom DioInstance</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/RSA-Encryption/">Harnessing RSA Encryption in Mobile Apps</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Tongze Mao. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>