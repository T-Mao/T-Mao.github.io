<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Integrating Stripe Payments in Mobile Apps | Tongze Mao </title> <meta name="author" content="Tongze Mao"> <meta name="description" content="A practical look at adding secure in-app payments and payouts with Stripe"> <meta name="keywords" content="Tongze Mao, Computer Science, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?86fbbecec189054f486c8d20d21d47df" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/notion_tran.ico?77fbfb63394a7e37d18d66a902a5f583"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://t-mao.github.io/blog/2025/Stripe-Payments/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Tongze</span> Mao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Integrating Stripe Payments in Mobile Apps</h1> <p class="post-meta"> Created in February 16, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/mobile"> <i class="fa-solid fa-hashtag fa-sm"></i> mobile</a>   <a href="/blog/tag/flutter"> <i class="fa-solid fa-hashtag fa-sm"></i> flutter</a>   <a href="/blog/tag/payments"> <i class="fa-solid fa-hashtag fa-sm"></i> payments</a>   <a href="/blog/tag/stripe"> <i class="fa-solid fa-hashtag fa-sm"></i> stripe</a>   ·   <a href="/blog/category/mobile-commerce"> <i class="fa-solid fa-tag fa-sm"></i> mobile-commerce</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <div class="row"> <div class="col-sm mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="https://www.digitalcommerce360.com/wp-content/uploads/2023/04/shutterstock_1936083859-480.webp 480w,https://www.digitalcommerce360.com/wp-content/uploads/2023/04/shutterstock_1936083859-800.webp 800w,https://www.digitalcommerce360.com/wp-content/uploads/2023/04/shutterstock_1936083859-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="https://www.digitalcommerce360.com/wp-content/uploads/2023/04/shutterstock_1936083859.jpg" class="rounded z-depth-1" width="100%" height="auto" style=" max-width: 800px; " title="Stripe Payments" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Handling secure payments and payouts is a critical component of many modern apps, especially those offering paid services or marketplaces. One robust solution for this domain is <a href="https://stripe.com/" rel="external nofollow noopener" target="_blank">Stripe</a>. Below I’ll walk through advanced use cases such as setting up PaymentIntents, ephemeral keys, connected accounts, and some behind-the-scenes tasks with Firebase Cloud Functions—all of which I have personally coded in production for my projects.</p> <h2 id="why-use-stripe">Why Use Stripe?</h2> <ol> <li> <strong>Security:</strong> Stripe offers top-tier PCI compliance and thorough documentation.</li> <li> <strong>Global Support:</strong> It handles multiple currencies and languages, simplifying worldwide deployment.</li> <li> <strong>Feature Breadth:</strong> Beyond simple charges, it supports advanced flows—like PaymentIntents, subscription management, Apple/Google Pay, connected accounts for payouts, etc.</li> <li> <strong>Developer-friendly:</strong> Clean REST APIs, webhooks, and official SDKs for popular platforms.</li> </ol> <h2 id="high-level-architecture">High-Level Architecture</h2> <p>My production systems typically revolve around these elements:</p> <ol> <li> <p><strong>Backend (e.g., Node.js, Firebase Functions, or custom server)</strong></p> <ul> <li>Securely stores Stripe API keys.</li> <li>Creates ephemeral keys, PaymentIntents, and handles card confirmations or verification flows.</li> <li>Manages connected accounts for multi-sided marketplaces (if your business includes payouts to external sellers).</li> <li>Often includes scheduling modules to handle delayed transfers or refunds.</li> </ul> </li> <li> <p><strong>Client-Side (Mobile App)</strong></p> <ul> <li>Initiates payment flows using ephemeral keys from the backend.</li> <li>Displays payment sheets or minimal UI for card input.</li> <li>Optionally integrates Google Pay or Apple Pay for frictionless checkout.</li> <li>Subscribes to real-time push notifications for status updates.</li> </ul> </li> </ol> <h3 id="a-note-on-push-notifications">A Note on Push Notifications</h3> <p>In my case, I also integrated FCM tokens and push-notification logic so that users and technicians receive timely payment or order updates. A specialized scheduling function scans Firestore for scheduled notifications, then sends them at the correct time. While this may not be strictly related to Stripe, it’s an essential part of delivering a cohesive mobile commerce experience.</p> <h2 id="payment-flow-in-a-nutshell">Payment Flow in a Nutshell</h2> <p>A typical in-app payment flow might look like this:</p> <ol> <li> <strong>User Chooses Product</strong>: The user selects a product or a service in your app.</li> <li> <strong>Backend Request</strong>: The mobile client calls your backend with product details (price, currency, etc.).</li> <li> <strong>Server Creates PaymentIntent</strong>: The server uses the Stripe API to create a PaymentIntent with the desired amount and currency.</li> <li> <strong>Ephemeral Key Generation</strong>: The server also retrieves or creates a Stripe <code class="language-plaintext highlighter-rouge">Customer</code> and returns an <a href="https://stripe.com/docs/api/ephemeral_keys" rel="external nofollow noopener" target="_blank">EphemeralKey</a> for the client’s current session.</li> <li> <strong>Display Payment UI</strong>: Your app either uses Stripe’s native Payment Sheet or a custom card entry form.</li> <li> <strong>Confirm Payment</strong>: The user enters payment details, Stripe processes them, and you receive a callback or webhook confirming success.</li> </ol> <h3 id="example-pseudocode-for-payment-creation">Example Pseudocode for Payment Creation</h3> <p>Below is a small snippet that reflects the approach I coded. On my backend, I store secrets as environment variables and then set up ephemeral keys accordingly:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">stripe</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">stripe</span><span class="dl">"</span><span class="p">)(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">STRIPE_SECRET_KEY</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">createPaymentIntent</span><span class="p">({</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">currency</span><span class="p">,</span> <span class="nx">customerId</span> <span class="p">})</span> <span class="p">{</span>
  <span class="c1">// Validate amounts and currency server-side</span>
  <span class="kd">const</span> <span class="nx">paymentIntent</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">stripe</span><span class="p">.</span><span class="nx">paymentIntents</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span>
    <span class="na">amount</span><span class="p">:</span> <span class="nx">amount</span><span class="p">,</span> <span class="c1">// e.g., 999 for $9.99</span>
    <span class="na">currency</span><span class="p">:</span> <span class="nx">currency</span><span class="p">,</span> <span class="c1">// e.g., 'usd'</span>
    <span class="na">customer</span><span class="p">:</span> <span class="nx">customerId</span><span class="p">,</span> <span class="c1">// existing or newly created customer</span>
    <span class="na">payment_method_types</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">card</span><span class="dl">"</span><span class="p">],</span>
    <span class="c1">// Additional configuration if needed</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">paymentIntent</span><span class="p">.</span><span class="nx">client_secret</span><span class="p">;</span> <span class="c1">// pass to the mobile app</span>
<span class="p">}</span>
</code></pre></div></div> <p>I typically wrap this in a Firebase Function or similar cloud function to securely interface with the mobile client. My real implementation also incorporates ephemeral key generation to allow dynamic updates to PaymentIntents from the client side, plus a few checks to ensure consistent currency and correct environment usage (test vs. production).</p> <h2 id="payouts-with-connected-accounts">Payouts with Connected Accounts</h2> <p>One advanced scenario is paying out to third parties—common in multi-vendor marketplaces or gig-economy apps. Stripe’s <a href="https://stripe.com/connect" rel="external nofollow noopener" target="_blank">Connect</a> flow allows you to:</p> <ol> <li>Create a <strong>connected account</strong> for each seller/technician.</li> <li>Collect payments from end customers.</li> <li>Programmatically distribute earnings to connected accounts.</li> </ol> <h3 id="example-flow">Example Flow</h3> <ul> <li> <strong>User Orders a Service</strong>: Payment goes into your platform’s Stripe account.</li> <li> <strong>Service Completed</strong>: The code calls <code class="language-plaintext highlighter-rouge">stripe.transfers.create()</code> or schedules future transfers to the connected account.</li> <li> <strong>Notification</strong>: The user and service provider receive updates on transaction statuses.</li> </ul> <p>I wrote a back-end routine that:</p> <ol> <li>Confirms a PaymentIntent is successful.</li> <li>Looks up the relevant connected account.</li> <li>Schedules or processes a transfer to that connected account—sometimes with a short delay, giving me time for validation.</li> </ol> <p>A <em>simplified</em> version:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">stripe</span><span class="p">.</span><span class="nx">transfers</span><span class="p">.</span><span class="nf">create</span><span class="p">({</span>
  <span class="na">amount</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="c1">// e.g., 2000 = $20.00</span>
  <span class="na">currency</span><span class="p">:</span> <span class="dl">"</span><span class="s2">usd</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">destination</span><span class="p">:</span> <span class="dl">"</span><span class="s2">acct_12345XYZ</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// The connected account ID</span>
<span class="p">});</span>
</code></pre></div></div> <p>Behind the scenes, it’s crucial to handle potential transfer failures, partial refunds, and edge cases like insufficient platform balance or incomplete KYC for the connected account. In my own code, I sometimes store these transfers in Firestore and run a scheduled function (Pub/Sub trigger) to finalize them once the funds fully settle.</p> <h2 id="implementation-nuances">Implementation Nuances</h2> <ol> <li> <strong>Sensitive API Keys</strong>: Keep them strictly on the server side. Do not embed secret keys in mobile code.</li> <li> <strong>Ephemeral Keys</strong>: They are short-lived. Renew them if a user session is extended or re-authenticated.</li> <li> <strong>Webhooks</strong>: Stripe can push real-time event notifications (e.g., <code class="language-plaintext highlighter-rouge">payment_intent.succeeded</code>, <code class="language-plaintext highlighter-rouge">payment_intent.payment_failed</code>). Make sure to securely handle these events in your backend for accurate status updates.</li> <li> <strong>Testing</strong>: Stripe’s sandbox environment with test card numbers is extremely helpful. Properly integrate test keys first, then pivot to live keys when you’re ready.</li> <li> <strong>Multi-Environment Strategy</strong>: I maintain separate function entry points for test vs. production flows, ensuring that test transactions never pollute the real environment.</li> </ol> <h3 id="interfacing-with-firebase-and-flutter">Interfacing with Firebase and Flutter</h3> <p>On the Flutter side, I rely on the <code class="language-plaintext highlighter-rouge">flutter_stripe</code> plugin to present the payment sheet or a custom card field. Meanwhile, my Firebase Functions handle ephemeral key creation, PaymentIntent creation, and additional push logic. This pattern ensures the app remains lightweight, with all critical secrets and logic secured in the cloud.</p> <h2 id="conclusion">Conclusion</h2> <p>Stripe offers a powerful suite of payment APIs for mobile apps. Through PaymentIntents and ephemeral keys, you can securely accept one-time card payments, manage recurring billing, or even orchestrate multi-party payouts with Connect. The code I wrote for my own applications carefully orchestrates these building blocks—ensuring a frictionless user experience, robust error handling, and a secure payment pipeline.</p> <p>Whether you need a quick “pay now” button or a sophisticated marketplace system, Stripe remains a reliable choice for in-app transactions. By focusing on well-structured backend endpoints, ephemeral key generation, and thoughtful error handling, you can confidently deploy production-grade payment solutions. My own additions—like scheduling push notifications and building advanced logic for delayed payouts—further showcase how integrating Stripe can be extended to meet real-world business complexities. If you’re building a mobile commerce or gig-economy platform, Stripe is definitely worth a serious look.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Chat/">Building a Real-Time Chat Feature</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Google-Maps/">Harnessing Google Maps for Real-Time Mobile Apps</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Network-Calls/">Streamlining Network Calls with a Custom DioInstance</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/RSA-Encryption/">Harnessing RSA Encryption in Mobile Apps</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/Push-Notifications/">Leveraging Push Notifications in Mobile Apps</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Tongze Mao. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>